<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Docker Registries</title>
	
	<meta name="author" content="Replicated">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="/favicons/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="/favicons/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />	
	<link rel="stylesheet" href='/css/style-0bcbae9332.css'>
	<link rel="stylesheet" href='/css/featherlight.min.css'>
	<link rel="stylesheet" href="/css/highlight/prism.css">
	
	<meta name="generator" content="Hugo 0.26" />
	
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
</head>
<body>
	<header>
		
			<nav class="other-nav">
		
			<div class="container u-position--relative">
				<ul class="flex justifyContent--spaceBetween alignItems--center nav-list paddingContainer u-position--relative">
					<li>
						<a class="logo-link" href="/">
							<img width="109" src="/images/ship-logo@2x.png"/>
						</a>
					</li>
					<li>
						<ul id="headerLinks" class="header-links">
							
								<li><a href="/docs" id="navItem--docs">Docs</a></li>
							
						</ul>
					</li>
				</ul>
			</div>
			<div class="container u-position--relative">
				<div class="guides-sub-nav">
    <div class="flex u-position--relative">
        <div class="arrow"></div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Configuring</h3>
            <div class="guide">
                <a href="/docs/initial-configuration">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Initial Configuration</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Configuring an application for the first deployment</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Testing</h3>
            <div class="guide">
                <a href="/docs/automated-testing">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automated Testing</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">How to test a Ship application</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Deploying</h3>
            <div class="guide">
                <a href="/docs/automated-deployment">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automated Deployment</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">How to automate the deployment of a Ship application.</p>
                </a>
            </div>
            <div class="guide u-marginTop--more">
                <a href="/docs/automated-deployment-kubernetes-app">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automatically Deploying to Kubernetes</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Set up a continuous delivery process to automate updates of a Kubernetes application.</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column u-position--relative">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Best Practices</h3>
            <div class="guide">
                <a href="/docs/manage-state">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Managing State</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Securely store and manage the Ship state file.</p>
                </a>
            </div>
            <div class="see-more flex alignItems--center u-position--absolute">
                <a href="/docs" class="u-fontWeight--medium u-fontSize--normal u-color--curiousBlue u-paddingRight--normal">See all docs</a>
                <span class="icon u-chevronIcon"></span>
            </div>
        </div>
    </div>
</div>

			</div>
		</nav>
	</header>
<main>
    <article class="single">
        <div class="u-gradient--greenToGreen main-section header flex-column flex1 justifyContent--center">
            <div class="container">
                <div class="paddingContainer">
                    <div class="flex flex-auto u-width--full justifyContent--spaceBetween alignItems--center u-marginTop--more">
                        <div class="u-width--full u-marginRight--more">
                            <h1 class="u-color--white u-fontWeight--bold u-fontSize--header u-textAlign--left">Docker Registries</h1>
                            <p class="u-fontSize--normal u-fontWeight--medium u-color--white u-marginTop--normal u-lineHeight--normal">Shipping a Docker Registry to support Airgap applications</p>
                        </div>
                        <div class="flex-auto u-hidden--mobileTablet">
                            <span class="icon u-replicatedShip u-marginRight--normal"></span>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="container">
            <div class="paddingContainer">
                <div class="u-flexTabletReflow flex1">
                    <div class="flex-auto sidebar-wrapper">
                        



<div class="sidebar">
        <div class="dropdown u-marginBottom--most">
            <p class="u-fontWeight--bold u-fontSize--largest u-color--tuna u-paddingBottom--normal">Documentation</p>
            <p class="u-fontSize--large u-fontWeight--medium u-cursor--pointer flex justifyContent--spaceBetween alignItems--center" id="dropdown-link">
                
                    <span>Docs</span>
                
                <span class="icon u-chevronIcon u-margingRight--small"></span>
            </p>
            <div class="menu" id="scheduler-dropdown-menu" style="display: none">
                <div class="u-paddingTop--small u-fontSize--normal u-fontWeight--bold u-color--curiousBlue u-paddingLeft--small">
                    <a href="/docs/native/getting-started/overview" class="u-color--curiousBlue">Ship</a>
                    <div class="u-marginTop--small">
                        <a href="/docs/native/getting-started/overview" class="u-fontWeight--medium u-color--tuna u-fontSize--small">
                            <p class="scheduler-menu-item-sub" class="u-lineHeight--normal">Ship Init</p>
                        </a>
                        <a href="/docs/native/getting-started/overview" class="u-fontWeight--medium u-color--tuna u-fontSize--small">
                            <p class="scheduler-menu-item-sub" class="u-lineHeight--normal">Ship Watch</p>
                        </a>
                        <a href="/docs/kubernetes/getting-started/overview" class="u-fontWeight--medium u-color--tuna u-fontSize--small">
                            <p class="scheduler-menu-item-sub" class="u-lineHeight--normal">Ship Update</p>
                        </a>
                        <a href="/docs/swarm/getting-started/overview" class="u-fontWeight--medium u-color--tuna u-fontSize--small">
                            <p class="scheduler-menu-item-sub" class="u-lineHeight--normal">Ship.yaml</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="desktop-only">
            
            
            
            
            
            
            
            
            
            
            
        </div>
    </div>

                        <div class="sidebar">
                            <div class="toc u-marginBottom--most">
                                <h3 class="u-fontWeight--medium u-lineHeight--normal u-borderBottom--gray u-paddingBottom--normal u-marginBottom--normal">Docker Registries</h3>
                                
                            </div>

                            
                        </div>
                    </div>
                    <div class="flex1 page-content-wrapper">
                        
                            <div class="page-content">
                                



    <h2 class="linked-headline" id="shipping-a-docker-registry-for-airgap-installations">
        <a href="/docs/playbooks/registry-kubernetes/#shipping-a-docker-registry-for-airgap-installations" class="anchor" id="#shipping-a-docker-registry-for-airgap-installations"></a>
        Shipping a Docker Registry for airgap installations
    </h2>


<p>When distributing a Kubernetes (or Helm) application, most customers will be able to provide a Docker registry that required application images can be pushed to. Replicated Ship can <a href="/docs/ship/recipes/airgap-kubernetes/">retag and rewrite the Kubernetes YAML</a> to work in this scenario.</p>

<p>If the Kubernetes cluster ] was set up using the <a href="/docs/kubernetes/customer-installations/installing-k8s-only/">Replicated Kubernetes installer</a>, a Docker registry might not be available. The Replicated Kubernetes installer will pre-pull the <code>registry:2</code> image on all nodes in the cluster.</p>





    <h2 class="linked-headline" id="docker-registry-assets">
        <a href="/docs/playbooks/registry-kubernetes/#docker-registry-assets" class="anchor" id="#docker-registry-assets"></a>
        Docker Registry Assets
    </h2>


<p>To start, include the following assets in a Ship release. These define the Docker registry, and will help get the registry bootstrapped into the cluster. Note that the <code>imagePullPolicy</code> in the <code>pod</code> is set to <code>Never</code> because the cluster should not attempt to pull the image from Docker Hub, and instead expect that the image will already be present.</p>

<pre><code class="language-yaml">assets:
  v1:
    - inline:
       dest: ./k8s/registry/registry-service.yml
       contents: |
         ---
         kind: Service
         apiVersion: v1
         metadata:
           name: registry
           namespace: docker-registry
         spec:
           selector:
             app: registry
           ports:
             - port: 5000
               targetPort: 5000

    - inline:
        dest: ./k8s/registry/registry-pod.yml
        contents: |
          ---
          apiVersion: v1
          kind: Pod
          metadata:
            name: registry
            labels:
              app: registry
            namespace: docker-registry
          spec:
            containers:
            - name: registry
              image: registry:2
              imagePullPolicy: Never
              ports:
                - containerPort: 5000
              volumes:
                - name: registry-data
                  awsElasticBlockStore:
                  volumeID: &lt;volume-id&gt;
                  fsType: ext4
            volumeMounts:
                - mountPath: /var/lib/registry
                  name: registry-data
</code></pre>





    <h2 class="linked-headline" id="private-images">
        <a href="/docs/playbooks/registry-kubernetes/#private-images" class="anchor" id="#private-images"></a>
        Private Images
    </h2>


<p>Next, include your private images in your Ship YAML as assets. This will force Ship to download these to the installation workstation:</p>

<pre><code class="language-yaml">assets:
  v1:
    - docker:
        dest: ./images/private-image.tar
        image: registry.replicated.com/myapplication/private-image:1
        source: replicated
    - inline:
        dest: ./k8s/pod.yml
        contents: |
          ---
          apiVersion: v1
          kind: Pod
          metadata:
            name: app
            labels:
              app: app
          spec:
            containers:
              - name: app
                image: docker-registry.svc.registry/myapplication/private-image:1
                imagePullPolicy: Always
</code></pre>





    <h2 class="linked-headline" id="installation-script">
        <a href="/docs/playbooks/registry-kubernetes/#installation-script" class="anchor" id="#installation-script"></a>
        Installation script
    </h2>


<pre><code class="language-yaml">assets:
  v1:
    - inline:
        dest: ./scripts/install.sh
        contents: |
          #!/bin/bash

          kubectl create ns docker-registry
          kubectl apply -f ../k8s/registry/

          kubectl get svc registry --namespace=docker-registry


          docker load &lt; ./installer/images/private-image.tar
          docker tag registry.replicated.com/myapplication/private-image:1 ${REGISTRY_ADDRESS}/myapplication/private-image:1
          docker push ${REGISTRY_ADDRESS}/myapplication/private-image:1

</code></pre>

                            </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div>
            
        </div>
    </article>
</main>
	<footer>
		<div class="container">
			<div class="footer-items-wrapper">
        <div class="footer-list flex1 paddingContainer">
					<div class="footer-list-item">
  <div class="footer-item">
    <div class="u-paddingBottom--normal">
      <a target="_blank" class="u-cursor--pointer" href="https://www.replicated.com">
        <img width="130" src="/images/footer_logo@2x.png"/>
      </a>
    </div>
    <div class="u-fontSize--small u-color--dustyGray u-marginBottom--small u-hidden--mobileTablet">&copy; 2018 <a> &nbsp;Replicated Inc.</a></div>
    <div class="u-fontSize--small u-color--dustyGray u-hidden--mobileTablet">All Rights Reserved</div>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Company</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com">About Replicated</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://blog.replicated.com">Replicated Blog</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover">RSS Feed</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Contact</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://twitter.com/replicatedhq">Twitter</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="mailto:contact@replicated.com">Email</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">More</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://github.com/replicatedhq">GitHub</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.enterpriseready.io">EnterpriseReady.io</a></li>
    </ul>
  </div>
</div>

        </div>
			</div>
		</div>
	</footer>

	
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-61084834-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
      </script>
    
 
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  
  

    
    
      
        <script src="/js/staging/autocomplete-search.js"></script>
      
      
    

  

	<script src="/js/prism.js"></script>
	<script>
		function toggleMenuClass() {
			this.classList.toggle("open");
			document.getElementById("headerLinks").classList.toggle("show");
		}
		const toggleMenu = document.getElementById("toggleNav");
		if (toggleMenu) {
			toggleMenu.addEventListener("click", toggleMenuClass);
		};
	</script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="/js/featherlight.min.js"></script>
	<script>
		$('#desktop-search').on("click", function () {
      if(!$('#search-field').is(":visible")) {
        $('#search-field').show("slide", { direction: "right" }, 300);
        $('#search-field').focus();
      }
		});

    $('#search-field').on("blur", function () {
      $(this).hide("slide", { direction: "right" }, 300);
    });

    $('#dropdown-link').on('click', function() {
      $('#scheduler-dropdown-menu').toggle();
    });

    $(document).on('click', function(e) {
      var target = e.target;
      if(target.id !== "dropdown-link") {
        $('#scheduler-dropdown-menu').hide();
      }
    });

    $('.tooltip').tooltip({
      position: {  my: "center bottom-10", at: "center top"  },
      show: { effect: "fade", duration: 200 },
      hide: { effect: "fade", duration: 200 }
    });

    $('#navItem--docs').on("mouseenter", function () {
      $('.guides-sub-nav').show();
    });
    $('#navItem--modern-on-prem').on("mouseenter", function () {
      $('.guides-sub-nav').hide();
    });
    
    $('.home-nav').on("mouseleave", function () {
      $('.guides-sub-nav').hide();
    });
    $('.other-nav').on("mouseleave", function (e) {
      $('.guides-sub-nav').hide();
    });
  </script>
  <script>
    $('a[href*="#"]')
      
      .not('[href="#"]')
      .not('[href="#0"]')
      .click(function(event) {
        
        if (
          location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
          && 
          location.hostname == this.hostname
        ) {
          
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
          
          if (target.length) {
            
            event.preventDefault();
            $('html, body').animate({
              scrollTop: target.offset().top
            }, 400);
          }
        }
      });
  </script>
</body>
</html>
