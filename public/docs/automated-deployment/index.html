<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Automated Deployment</title>
	
	<meta name="author" content="Replicated">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="/favicons/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="/favicons/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />	
	<link rel="stylesheet" href='/css/style-0bcbae9332.css'>
	<link rel="stylesheet" href='/css/featherlight.min.css'>
	<link rel="stylesheet" href="/css/highlight/prism.css">
	
	<meta name="generator" content="Hugo 0.26" />
	
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
</head>
<body>
	<header>
		
			<nav class="other-nav">
		
			<div class="container u-position--relative">
				<ul class="flex justifyContent--spaceBetween alignItems--center nav-list paddingContainer u-position--relative">
					<li>
						<a class="logo-link" href="/">
							<img width="109" src="/images/ship-logo@2x.png"/>
						</a>
					</li>
					<li>
						<ul id="headerLinks" class="header-links">
							
								<li><a href="/docs" id="navItem--docs">Docs</a></li>
							
						</ul>
					</li>
				</ul>
			</div>
			<div class="container u-position--relative">
				<div class="guides-sub-nav">
    <div class="flex u-position--relative">
        <div class="arrow"></div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Configuring</h3>
            <div class="guide">
                <a href="/docs/initial-configuration">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Initial Configuration</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Configuring an application for the first deployment</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Testing</h3>
            <div class="guide">
                <a href="/docs/automated-testing">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automated Testing</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">How to test a Ship application</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Deploying</h3>
            <div class="guide">
                <a href="/docs/automated-deployment">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automated Deployment</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">How to automate the deployment of a Ship application.</p>
                </a>
            </div>
            <div class="guide u-marginTop--more">
                <a href="/docs/automated-deployment-kubernetes-app">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Automatically Deploying to Kubernetes</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Set up a continuous delivery process to automate updates of a Kubernetes application.</p>
                </a>
            </div>
        </div>
        <div class="guide-wrapper flex flex-column u-position--relative">
            <h3 class="u-fontWeight--bold u-fontSize--normal u-color--shipGreen u-marginBottom--more">Best Practices</h3>
            <div class="guide">
                <a href="/docs/manage-state">
                    <p class="u-fontSize--small u-fontWeight--medium u-marginBottom--small u-color--darkBlue u-lineHeight--normal">Managing State</p>
                    <p class="u-fontSize--small u-color--dustyGray u-lineHeight--normal">Securely store and manage the Ship state file.</p>
                </a>
            </div>
            <div class="see-more flex alignItems--center u-position--absolute">
                <a href="/docs" class="u-fontWeight--medium u-fontSize--normal u-color--curiousBlue u-paddingRight--normal">See all docs</a>
                <span class="icon u-chevronIcon"></span>
            </div>
        </div>
    </div>
</div>

			</div>
		</nav>
	</header>
<main>
    <article class="single">
        <div class="u-gradient--greenToGreen main-section header flex-column flex1 justifyContent--center">
            <div class="container">
                <div class="paddingContainer">
                    <div class="flex flex-auto u-width--full justifyContent--spaceBetween alignItems--center u-marginTop--more">
                        <div class="u-width--full u-marginRight--more">
                            <h1 class="u-color--white u-fontWeight--bold u-fontSize--header u-textAlign--left">Automated Deployment</h1>
                            <p class="u-fontSize--normal u-fontWeight--medium u-color--white u-marginTop--normal u-lineHeight--normal">Automated Deployment</p>
                        </div>
                        <div class="flex-auto u-hidden--mobileTablet">
                            <span class="icon u-replicatedCircle u-marginRight--normal"></span>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="container">
            <div class="paddingContainer">
                <div class="u-flexTabletReflow flex1">
                    <div class="flex-auto sidebar-wrapper">
                        <div class="sidebar">
                            <div class="toc u-marginBottom--most">
                                <h3 class="u-fontWeight--medium u-lineHeight--normal u-borderBottom--gray u-paddingBottom--normal u-marginBottom--normal">Automated Deployment</h3>
								<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#create-state-json-and-release-yml">Create state.json and release.yml</a>
<ul>
<li><a href="#extract-the-state-json-and-ship-yml">Extract the state.json and ship.yml</a></li>
<li><a href="#state-json">state.json</a></li>
<li><a href="#release-yaml">release.yaml</a></li>
</ul></li>
<li><a href="#automate-release-creation">Automate release creation</a></li>
<li><a href="#deploy">Deploy</a></li>
<li><a href="#related-documents">Related documents</a></li>
</ul></li>
</ul>
</nav>
                            </div>

                            
                        </div>
                    </div>
                    <div class="flex1 page-content-wrapper">
                        
                            <div class="page-content">
                                

<p>Applications delivered in Replicated Ship can be deployed using automation instead of manually running installation scripts. It&rsquo;s possible to deploy the first release of an application completely automated, even to airgapped environments. The process to automate deployment of an application varies, depending on the automation tools used. This document defines the steps involved in automating the deployment of an on-prem application, with links to specific implementations, when possible.</p>

<p>The process to automate deployment of an application involves 3 steps:</p>

<ol>
<li>Create the initial <code>state.json</code> and <code>release.yml</code>.</li>
<li>From these 2 files, automate creation of all required assets</li>
<li>Execute the install script to deploy</li>
</ol>

<h2 id="create-state-json-and-release-yml">Create state.json and release.yml&nbsp;<a class="headline-hash" href="#create-state-json-and-release-yml">#</a> </h2>

<p>From a workstation (not the server) running Docker, run the setup command provided by the software vendor. For example:</p>

<pre><code class="language-shell">curl -sSL https://get.replicated.com/ship?customer_id=&lt;your_license_key&gt; | docker-compose -f - up
</code></pre>

<p>This will download a couple of Docker containers and then show a message similar to this:</p>

<pre><code class="language-shell">Please visit the following URL in your browser to continue the installation

        http://localhost:8800

</code></pre>

<p>Next, open the URL provided (<a href="http://localhost:8800">http://localhost:8800</a>). This is the Admin Console. This UI will prompt for some input values and provide instructions to install. Using the Admin Console, supply all of the intial configuration values and click Save and then Continue.</p>

<h3 id="extract-the-state-json-and-ship-yml">Extract the state.json and ship.yml&nbsp;<a class="headline-hash" href="#extract-the-state-json-and-ship-yml">#</a> </h3>

<p>At this point, there are two new directories created on the workstation: <code>.ship</code> and <code>installer</code>.</p>

<p><code>./installer</code>: This directory contains generated scripts and assets that are needed to deploy the application. This contains docker images, kubernetes manifests, or anything else needed to deploy and run the application in an airgapped environment. Because the goal is to automate deployment, this directory isn&rsquo;t needed now. It&rsquo;s ok to delete.</p>

<p><code>./ship</code>: This directory contains the two files that are needed to automate the initial installation. Find the files named <code>./ship/state.json</code> and <code>./ship/release.yml</code>. These files are described below:</p>

<h3 id="state-json">state.json&nbsp;<a class="headline-hash" href="#state-json">#</a> </h3>

<p>The configured state will be in a single file, stored in <code>.ship/state.json</code>. This file may contain secrets and confidental information such as database passwords and more. Don&rsquo;t check this file into source control without taking <a href="../manage-state">proper steps to ensure it remains secret</a>.</p>

<h3 id="release-yaml">release.yaml&nbsp;<a class="headline-hash" href="#release-yaml">#</a> </h3>

<p>The original YAML file that the software vendor created and was used as an input to create the local assets is stored in <code>./.ship/release.yaml</code>. This file doesn&rsquo;t contain any secrets, it&rsquo;s a generic release manifest. This file can be commited to a configuration management repo or any other tool to automate deployment.</p>

<h2 id="automate-release-creation">Automate release creation&nbsp;<a class="headline-hash" href="#automate-release-creation">#</a> </h2>

<p>From the <code>state.json</code> and <code>release.yml</code>, it&rsquo;s possible to generate all assets that were originally created under the <code>installer/</code> directory, using the following command:</p>

<pre><code class="language-shell">$ docker run -v `PWD`:/in  -v`PWD`:/out \
    -e CUSTOMER_ID=&lt;customer_id&gt; replicated/ship:1 \
    --headless \
    --studio-file=./ship/release.yml
</code></pre>

<p>This will pull the Replicated Ship container, then it will use the Ship container to build and fetch all required assets. The command will mount the <code>release.yml</code> and <code>state.json</code> files into known locations for the <code>replicated/ship</code> container to read. Using the customer_id provided (the license key), the ship container will pull all images or artifacts, and apply the state.json values to them to create the deployable assets.</p>

<h2 id="deploy">Deploy&nbsp;<a class="headline-hash" href="#deploy">#</a> </h2>

<p>Deploying the application is as simple as running <code>./installer/scripts/install.sh</code>. This installer is customized with the configuration info that was passed in, and will deploy to the target servers or clusters that are defined.</p>

<hr />

<h2 id="related-documents">Related documents&nbsp;<a class="headline-hash" href="#related-documents">#</a> </h2>

<ul>
<li><a href="../automated-deployment-kubernetes-app">Automated Deployment of a Kubernetes application</a></li>
<li><a href="../automated-updates-circleci">Automated Updates with CircleCI</a></li>
<li><a href="../automated-testing">Automated Testing</a></li>
</ul>

                            </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div>
            
        </div>
    </article>
</main>
	<footer>
		<div class="container">
			<div class="footer-items-wrapper">
        <div class="footer-list flex1 paddingContainer">
					<div class="footer-list-item">
  <div class="footer-item">
    <div class="u-paddingBottom--normal">
      <a target="_blank" class="u-cursor--pointer" href="https://www.replicated.com">
        <img width="130" src="/images/footer_logo@2x.png"/>
      </a>
    </div>
    <div class="u-fontSize--small u-color--dustyGray u-marginBottom--small u-hidden--mobileTablet">&copy; 2018 <a> &nbsp;Replicated Inc.</a></div>
    <div class="u-fontSize--small u-color--dustyGray u-hidden--mobileTablet">All Rights Reserved</div>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Company</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com">About Replicated</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://blog.replicated.com">Replicated Blog</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover">RSS Feed</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Contact</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://twitter.com/replicatedhq">Twitter</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="mailto:contact@replicated.com">Email</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">More</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://github.com/replicatedhq">GitHub</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.enterpriseready.io">EnterpriseReady.io</a></li>
    </ul>
  </div>
</div>

        </div>
			</div>
		</div>
	</footer>

	
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-61084834-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
      </script>
    
 
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  
  

    
    
      
        <script src="/js/staging/autocomplete-search.js"></script>
      
      
    

  

	<script src="/js/prism.js"></script>
	<script>
		function toggleMenuClass() {
			this.classList.toggle("open");
			document.getElementById("headerLinks").classList.toggle("show");
		}
		const toggleMenu = document.getElementById("toggleNav");
		if (toggleMenu) {
			toggleMenu.addEventListener("click", toggleMenuClass);
		};
	</script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="/js/featherlight.min.js"></script>
	<script>
		$('#desktop-search').on("click", function () {
      if(!$('#search-field').is(":visible")) {
        $('#search-field').show("slide", { direction: "right" }, 300);
        $('#search-field').focus();
      }
		});

    $('#search-field').on("blur", function () {
      $(this).hide("slide", { direction: "right" }, 300);
    });

    $('#dropdown-link').on('click', function() {
      $('#scheduler-dropdown-menu').toggle();
    });

    $(document).on('click', function(e) {
      var target = e.target;
      if(target.id !== "dropdown-link") {
        $('#scheduler-dropdown-menu').hide();
      }
    });

    $('.tooltip').tooltip({
      position: {  my: "center bottom-10", at: "center top"  },
      show: { effect: "fade", duration: 200 },
      hide: { effect: "fade", duration: 200 }
    });

    $('#navItem--docs').on("mouseenter", function () {
      $('.guides-sub-nav').show();
    });
    $('#navItem--modern-on-prem').on("mouseenter", function () {
      $('.guides-sub-nav').hide();
    });
    
    $('.home-nav').on("mouseleave", function () {
      $('.guides-sub-nav').hide();
    });
    $('.other-nav').on("mouseleave", function (e) {
      $('.guides-sub-nav').hide();
    });
  </script>
  <script>
    $('a[href*="#"]')
      
      .not('[href="#"]')
      .not('[href="#0"]')
      .click(function(event) {
        
        if (
          location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
          && 
          location.hostname == this.hostname
        ) {
          
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
          
          if (target.length) {
            
            event.preventDefault();
            $('html, body').animate({
              scrollTop: target.offset().top
            }, 400);
          }
        }
      });
  </script>
</body>
</html>
