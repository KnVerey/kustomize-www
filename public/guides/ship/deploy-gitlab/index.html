<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Deploying GitLab With Ship</title>
	
	<meta name="author" content="Replicated">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="/favicons/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="/favicons/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />
	<link rel="stylesheet" href='/css/style-7a29e25363.css'>
	<link rel="stylesheet" href='/css/featherlight.min.css'>
	<link rel="stylesheet" href="/css/highlight/prism.css">
	
	<meta name="generator" content="Hugo 0.26" />
	
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
</head>
<body>
	<header>
		<nav>
			<div class="container u-position--relative">
				<a href="/search" id="mobile-search" class="searchIcon--white"></a>
				<span id="toggleNav" class="u-show--mobileTablet icon u-cursor--pointer"></span>
				<ul class="nav-list paddingContainer u-position--relative">
					<li>
						<a class="logo-link" href="/">
							<img width="109" src="/images/logo@2x.png"/>
						</a>
					</li>
					<li>
						<ul id="headerLinks" class="header-links">
							
								<li><a href="/guides/">Guides</a></li>
							
								<li><a href="/docs/native/getting-started/overview/">Documentation</a></li>
							
								<li><a href="/api/">API Reference</a></li>
							
								<li><a href="https://help.replicated.com/community/">Community</a></li>
							
							<li>
								<div class="search-form">
									<input type="text" placeholder="What are you looking for?" id="search-field" style="display: none;" />
									<span class="searchIcon--white" id="desktop-search"></span>
								</div>
							</li>
							<li class="log-in-link">
								<span><a href="https://vendor.replicated.com" target="_blank">Log in</a></span>
								
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
	</header>

<main>
    <article class="single">
            
                <div class="u-gradient--console main-section header flex-column flex1 justifyContent--center">
            
            <div class="container">
                <div class="paddingContainer">
                    <div class="flex flex-auto u-width--full justifyContent--spaceBetween alignItems--center u-marginTop--more">
                        <div class="u-width--full u-marginRight--more">
                            <h1 class="u-color--white u-fontWeight--bold u-fontSize--header u-textAlign--left">Deploying GitLab With Ship</h1>
                            <p class="u-fontSize--normal u-fontWeight--medium u-color--white u-marginTop--normal u-lineHeight--normal">A guide to creating and shipping a Kubernetes app with Ship</p>
                        </div>
                        <div class="flex-auto u-hidden--mobileTablet">
                            <span class="icon u-replicatedShip u-marginRight--normal"></span>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="container">
            <div class="paddingContainer">
                <div class="u-flexTabletReflow flex1">
                    <div class="flex-auto sidebar-wrapper">
                        <div class="sidebar">
                            <div>
                                
                                    <h3 class="u-fontWeight--medium u-borderBottom--gray u-paddingBottom--normal u-marginBottom--normal">Ship Guide</h3>
                                    <ul>
                                    
                                    
                                        
                                            
                                                
                                                    <li class="blue"><a href="/guides/ship/deploy-gitlab/">Deploying GitLab With Ship</a></li>
                                                
                                            
                                        
                                    
                                </ul>
                                
                            </div>
                        </div>
                    </div>
                    <div class="flex1 page-content-wrapper">
                        <div class="page-content">
                            
<h2 class="linked-headline" id="create-a-customer">
    <a href="/guides/ship/deploy-gitlab/#create-a-customer" class="anchor" id="#create-a-customer"></a>
    Create a Customer
</h2>


<p>To begin, log in (or create an account) on <a href="https://console.replicated.com">console.replicated.com</a>. If you already have an account on <a href="https://vendor.replicated.com">vendor.replicated.com</a>, you can use it here too. After signing up and activating your account, you&rsquo;ll be presented with the opportunity to create a new customer. Here we&rsquo;ll be using &lsquo;ATestCustomer&rsquo;.</p>

<p><img src="/images/guides/ship/created-customer.png" alt="Create Customer" /></p>


<h2 class="linked-headline" id="navigate-to-ship">
    <a href="/guides/ship/deploy-gitlab/#navigate-to-ship" class="anchor" id="#navigate-to-ship"></a>
    Navigate To Ship
</h2>


<p>The Ship product page can be found through the &lsquo;Products&rsquo; dropdown.</p>

<p><img src="/images/guides/ship/products-dropdown.png" alt="Products Dropdown" /></p>

<p>If you haven&rsquo;t visited before, you&rsquo;ll see a prompt to get started with Release Channels.</p>

<p><img src="/images/guides/ship/release-channels.png" alt="Release Channels" /></p>


<h2 class="linked-headline" id="get-started-with-release-channels">
    <a href="/guides/ship/deploy-gitlab/#get-started-with-release-channels" class="anchor" id="#get-started-with-release-channels"></a>
    Get Started With Release Channels
</h2>


<p>By default, three release channels are created - Stable, Beta and Nightly. We&rsquo;ll start with a release on the Nightly channel. Once we&rsquo;ve done some testing, we&rsquo;ll promote it to Beta.</p>

<p><img src="/images/guides/ship/stable-beta-nightly.png" alt="Create Release Channel" /></p>


<h2 class="linked-headline" id="editing-a-release">
    <a href="/guides/ship/deploy-gitlab/#editing-a-release" class="anchor" id="#editing-a-release"></a>
    Editing a Release
</h2>


<p>A Ship release is a yaml file describing the assets to include, the configuration options to present to the installer, and what text to display at runtime. We&rsquo;ll use the builtin editor on console to get started.</p>

<p><img src="/images/guides/ship/edit-release.png" alt="Edit Yaml" /></p>

<p>There are three sections to the Ship yaml - assets, config, and lifecycle.</p>

<ol>
<li>Assets</li>
</ol>

<pre><code class="language-yaml">assets:
  v1:
  - inline:
      contents: |
        #!/bin/sh
        git clone git@gitlab.com:charts/gitlab.git
        helm dependencies update
        helm upgrade --install gitlab . \
          --timeout 600 \
          --set global.hosts.domain={{repl config &quot;domain_name&quot;}} \
          {{repl if {{repl config &quot;external_ip&quot;}} }}--set global.hosts.externalIP={{repl config &quot;external_ip&quot;}}{{end}} \
          --set gitlab.migrations.initialRootPassword={{repl config &quot;gitlab_root_password&quot;}} \
          --set certmanager-issuer.email={{repl config &quot;certificate_email&quot;}} \
          {{repl if {{repl config &quot;external_postgres&quot;}} }} --set global.psql.host={{repl config &quot;postgres_host&quot;}} \
          --set global.psql.password.secret={{repl config &quot;postgres_k8s_secret_name&quot;}} \
          --set global.psql.password.key={{repl config &quot;postgres_password&quot;}} {{repl end}} \
          {{repl if {{repl config &quot;redis_ha&quot;}} }}--set redis.enabled=false --set redis-ha.enabled=true{{repl end}} 

      dest: ./assets/install.sh
      mode: 0777
  - inline:
      contents: |
        #!/bin/sh

      dest: ./assets/uninstall.sh
      mode: 0777
</code></pre>

<p>The <code>assets</code> section describes the files that ship will create when run. There are two types of assets currently supported in Ship, though we&rsquo;ll only be using <code>inline</code> here. <code>inline</code> assets create templated files at the destination location, while <code>docker</code> assets do the same with exported Docker images. For the purposes of this demo, we&rsquo;ll be using public Docker images with no allowance for airgapped installations, but normally we would explicitly include all the Docker images within the Ship yaml.</p>

<ol>
<li>Config</li>
</ol>

<pre><code class="language-yaml">config:
  v1:
    - name: config_options
      title: Gitlab Configuration Options
      description: The options required by GitLab
      items:
      - name: domain_name
        title: Domain Name
        description: Specify a domain which will contain records to resolve gitlab, registry, and minio to the appropriate IP for your chart
        type: text
        required: true
      - name: external_ip
        title: External IP
        description: If you plan to manually configure your DNS records they should all point to a static IP. For example if you choose example.local and you have a static IP of 10.10.10.10, then gitlab.example.local, registry.example.local and minio.example.local should all resolve to 10.10.10.10.
        type: text
        required: false
      - name: gitlab_root_password
        title: Gitlab Root Password
        description: The initial root password for GitLab.
        type: text
        required: true
      - name: certificate_email
        title: Certificate Email
        description: The email to associate with the letsencrypt certificates generated by cert-manager.
        type: text
        required: true
      - name: external_postgres
        title: Use an External Postgres Database
        type: bool
        required: true
      - name: postgres_host
        title: External Postgres Host
        description: The hostname of the external postgres instance GitLab should use
        type: text
        when: '{{repl ConfigOptionEquals &quot;external_postgres&quot; &quot;1&quot;}}'
        required: true
      - name: postgres_k8s_secret_name
        title: External Postgres Kubernetes Secret Name
        description: The name of the Kubernetes secret Postgres should use
        type: text
        when: '{{repl ConfigOptionEquals &quot;external_postgres&quot; &quot;1&quot;}}'
        required: true
      - name: postgres_password
        title: External Postgres Password
        description: The key of the password for  the external postgres instance GitLab should use
        type: password
        when: '{{repl ConfigOptionEquals &quot;external_postgres&quot; &quot;1&quot;}}'
        required: true
      - name: redis_ha
        title: Redis-ha
        description: Use high availibility Redis-ha
        type: bool
</code></pre>

<p>The <code>configuration</code> section uses the same layout and structure as that of Replicated, and is greatly expanded upon <a href="https://help.replicated.com/docs/config-screen/config-yaml/">here</a>. There is one exception - &lsquo;when&rsquo; fields can only be templatable strings. We&rsquo;ll use it to determine what settings the user would like for their GitLab installation.</p>

<ol>
<li>Lifecycle</li>
</ol>

<pre><code class="language-yaml">lifecycle:
  v1:
    - message:
        contents: |
          This tool will prepare assets so you can deploy GitLab-Enterpise
          to your existing Kubernetes cluster
    - render: {}
    - message:
        contents: |
          GitLab is ready to deploy to your kubernetes cluster.
          
          If you have Helm configured locally, you can
          run the following command to deploy GitLab to
          your kubernetes cluster:
              
              bash ./scripts/install.sh
    - message:
        level: warn
        contents: |
          A state file has been written to {{repl context &quot;state_file_path&quot; }} -- please store it
          somewhere safe, you'll need it if you want to recover or update this installation of GitLab.
</code></pre>

<p>The <code>lifecycle</code> section is the messaging that will be seen by the end user. Contents will be printed to the screen in order during execution, with <code>render: {}</code> being replaced with the configuration options. Message levels change the color of the rendered text, and can be <code>debug</code>, <code>info</code> (the default), <code>warn</code> or <code>error</code>.</p>

<p>Once we&rsquo;ve finished editing our yaml, we can create a release from it.</p>

<p><img src="/images/guides/ship/create-release.png" alt="Create Release" /></p>


<h2 class="linked-headline" id="add-customer-to-channel">
    <a href="/guides/ship/deploy-gitlab/#add-customer-to-channel" class="anchor" id="#add-customer-to-channel"></a>
    Add Customer To Channel
</h2>


<p>Before we can test our app, we need to add a customer to the channel. Since Nightly releases shouldn&rsquo;t be going to production, we&rsquo;ll add ATestCustomer.</p>

<p><img src="/images/guides/ship/channel-details-withcust.png" alt="Add Customer To Channel" /></p>


<h2 class="linked-headline" id="installing-the-release">
    <a href="/guides/ship/deploy-gitlab/#installing-the-release" class="anchor" id="#installing-the-release"></a>
    Installing the Release
</h2>


<p>Now we can produce an installation script for our test customer.</p>

<p><img src="/images/guides/ship/install-script.png" alt="Install A Release" /></p>


<h2 class="linked-headline" id="promoting-a-release">
    <a href="/guides/ship/deploy-gitlab/#promoting-a-release" class="anchor" id="#promoting-a-release"></a>
    Promoting a Release
</h2>


<p>Once we&rsquo;ve tested things out, we can promote the release to the Beta channel.</p>

<p><img src="/images/guides/ship/promote-release.png" alt="Promote Release" /></p>

                            <div class="prev-next-arrows justifyContent--spaceBetween flex u-marginTop--most">
                                <div class="next flex u-textAlign--left">
                                
                                    
                                        <a href="/guides/ship-with-kubernetes/managing-storage/">
                                            <span class="icon u-chevronIcon"></span>
                                            Managing Storage
                                        </a>
                                    
                                
                                </div>
                                <div class="previous flex u-textAlign--right">
                                
                                    
                                        <a href="/guides/ship-with-docker-swarm/create-swarm-app/">
                                            Creating a Replicated &#43; Swarm Release
                                            <span class="icon u-chevronIcon"></span>
                                        </a>
                                    
                                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            
        </div>
    </article>
</main>
	<footer>
		<div class="container">
			<div class="footer-items-wrapper">
        <div class="footer-list flex1 paddingContainer">
					<div class="footer-list-item">
  <div class="footer-item">
    <div class="u-paddingBottom--normal">
      <a target="_blank" class="u-cursor--pointer" href="https://www.replicated.com">
        <img width="130" src="/images/footer_logo@2x.png"/>
      </a>
    </div>
    <div class="u-fontSize--small u-color--dustyGray u-marginBottom--small u-hidden--mobileTablet">&copy; 2018 <a> &nbsp;Replicated Inc.</a></div>
    <div class="u-fontSize--small u-color--dustyGray u-hidden--mobileTablet">All Rights Reserved</div>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Help Center</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/guides">Guides</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/docs">Documentation</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/api">API Reference</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://vendor.replicated.com/support">Contact Support</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Company</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com">About Replicated</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://blog.replicated.com">Replicated Blog</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com/careers">Careers</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover">RSS Feed</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Contact</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://twitter.com/replicatedhq">Twitter</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="mailto:contact@replicated.com">Email</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">More</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://github.com/replicatedhq">GitHub</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.enterpriseready.io">EnterpriseReady.io</a></li>
    </ul>
  </div>
</div>

        </div>
			</div>
		</div>
	</footer>

	
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-61084834-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
      </script>
    
 
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  
  

    
    
      
        <script src="/js/staging/autocomplete-search.js"></script>
      
      
    

  

	<script src="/js/prism.js"></script>
	<script>
		function toggleMenuClass() {
			this.classList.toggle("open");
			document.getElementById("headerLinks").classList.toggle("show");
		}
		const toggleMenu = document.getElementById("toggleNav");
		if (toggleMenu) {
			toggleMenu.addEventListener("click", toggleMenuClass);
		};
	</script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="/js/featherlight.min.js"></script>
	<script>
		$('#desktop-search').on("click", function () {
      if(!$('#search-field').is(":visible")) {
        $('#search-field').show("slide", { direction: "right" }, 300);
        $('#search-field').focus();
      }
		});

    $('#search-field').on("blur", function () {
      $(this).hide("slide", { direction: "right" }, 300);
    });

    $('#dropdown-link').on('click', function() {
      $('#scheduler-dropdown-menu').toggle();
    });

    $(document).on('click', function(e) {
      var target = e.target;
      if(target.id !== "dropdown-link") {
        $('#scheduler-dropdown-menu').hide();
      }
    });

    $('.tooltip').tooltip({
      position: {  my: "center bottom-10", at: "center top"  },
      show: { effect: "fade", duration: 200 },
      hide: { effect: "fade", duration: 200 }
    });
	</script>
</body>
</html>
