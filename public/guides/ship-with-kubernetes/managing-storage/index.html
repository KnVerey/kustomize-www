<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Managing Storage</title>
	
	<meta name="author" content="Replicated">
	<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png" />
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png" />
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png" />
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png" />
	<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png" />
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png" />
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png" />
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png" />
	<link rel="icon" type="image/png" href="/favicons/favicon-196x196.png" sizes="196x196" />
	<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32" />
	<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16" />
	<link rel="icon" type="image/png" href="/favicons/favicon-128.png" sizes="128x128" />
	<meta name="application-name" content="&nbsp;"/>
	<meta name="msapplication-TileColor" content="#FFFFFF" />
	<meta name="msapplication-TileImage" content="mstile-144x144.png" />
	<meta name="msapplication-square70x70logo" content="mstile-70x70.png" />
	<meta name="msapplication-square150x150logo" content="mstile-150x150.png" />
	<meta name="msapplication-wide310x150logo" content="mstile-310x150.png" />
	<meta name="msapplication-square310x310logo" content="mstile-310x310.png" />
	<link rel="stylesheet" href='/css/style-7a29e25363.css'>
	<link rel="stylesheet" href='/css/featherlight.min.css'>
	<link rel="stylesheet" href="/css/highlight/prism.css">
	
	<meta name="generator" content="Hugo 0.26" />
	
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
</head>
<body>
	<header>
		<nav>
			<div class="container u-position--relative">
				<a href="/search" id="mobile-search" class="searchIcon--white"></a>
				<span id="toggleNav" class="u-show--mobileTablet icon u-cursor--pointer"></span>
				<ul class="nav-list paddingContainer u-position--relative">
					<li>
						<a class="logo-link" href="/">
							<img width="109" src="/images/logo@2x.png"/>
						</a>
					</li>
					<li>
						<ul id="headerLinks" class="header-links">
							
								<li><a href="/guides/">Guides</a></li>
							
								<li><a href="/docs/native/getting-started/overview/">Documentation</a></li>
							
								<li><a href="/api/">API Reference</a></li>
							
								<li><a href="https://help.replicated.com/community/">Community</a></li>
							
							<li>
								<div class="search-form">
									<input type="text" placeholder="What are you looking for?" id="search-field" style="display: none;" />
									<span class="searchIcon--white" id="desktop-search"></span>
								</div>
							</li>
							<li class="log-in-link">
								<span><a href="https://vendor.replicated.com" target="_blank">Log in</a></span>
								
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
	</header>

<main>
    <article class="single">
            
                <div class="u-gradient--kubernetes main-section header flex-column flex1 justifyContent--center">
            
            <div class="container">
                <div class="paddingContainer">
                    <div class="flex flex-auto u-width--full justifyContent--spaceBetween alignItems--center u-marginTop--more">
                        <div class="u-width--full u-marginRight--more">
                            <h1 class="u-color--white u-fontWeight--bold u-fontSize--header u-textAlign--left">Managing Storage</h1>
                            <p class="u-fontSize--normal u-fontWeight--medium u-color--white u-marginTop--normal u-lineHeight--normal">Overview of how Persistent Volumes work with Replicated</p>
                        </div>
                        <div class="flex-auto u-hidden--mobileTablet">
                            <span class="icon u-replicatedKubernetes u-marginRight--normal"></span>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="container">
            <div class="paddingContainer">
                <div class="u-flexTabletReflow flex1">
                    <div class="flex-auto sidebar-wrapper">
                        <div class="sidebar">
                            <div>
                                
                                    <h3 class="u-fontWeight--medium u-borderBottom--gray u-paddingBottom--normal u-marginBottom--normal">Kubernetes Guide</h3>
                                    <ul>
                                    
                                    
                                        
                                            
                                                
                                                    <li><a href="/guides/ship-with-kubernetes/create-release/" class="u-color--curiousBlue">Create a Kubernetes Release</a></li>
                                                
                                            
                                        
                                            
                                                
                                                    <li><a href="/guides/ship-with-kubernetes/install/" class="u-color--curiousBlue">Installing and Testing a Kubernetes Release</a></li>
                                                
                                            
                                        
                                            
                                                
                                                    <li><a href="/guides/ship-with-kubernetes/iterate/" class="u-color--curiousBlue">Iterating and Updating</a></li>
                                                
                                            
                                        
                                            
                                                
                                                    <li class="blue"><a href="/guides/ship-with-kubernetes/managing-storage/">Managing Storage</a></li>
                                                
                                            
                                        
                                    
                                </ul>
                                
                            </div>
                        </div>
                    </div>
                    <div class="flex1 page-content-wrapper">
                        <div class="page-content">
                            
<h2 class="linked-headline" id="rook">
    <a href="/guides/ship-with-kubernetes/managing-storage/#rook" class="anchor" id="#rook"></a>
    Rook
</h2>


<p>Replicated&rsquo;s Kubernetes scheduler uses <a href="https://rook.io/">Rook</a> to dynamically provision storage for Persistent Volume Claims required by Replicated and your app.</p>


<h2 class="linked-headline" id="replication">
    <a href="/guides/ship-with-kubernetes/managing-storage/#replication" class="anchor" id="#replication"></a>
    Replication
</h2>


<p>Replicated&rsquo;s install script will default to creating a cluster backed by the host directory <code>/opt/replicated/rook</code>.
Each file in the cluster begins with a single copy, i.e. without replication.
When a new node is added to the cluster, you can edit the Pool custom resource named <code>replicapool</code> in the <code>rook</code> namespace and configure it to store copies of each file on two separate hosts:</p>

<pre><code class="language-shell">kubectl -n rook patch pool replicapool --type='json' -p='[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/replicated/size&quot;, &quot;value&quot;: 2}]'
</code></pre>


<h2 class="linked-headline" id="dynamic-provisioning-in-cloud-environments">
    <a href="/guides/ship-with-kubernetes/managing-storage/#dynamic-provisioning-in-cloud-environments" class="anchor" id="#dynamic-provisioning-in-cloud-environments"></a>
    Dynamic Provisioning in Cloud Environments
</h2>


<p>The <a href="https://kubernetes.io/docs/concepts/architecture/cloud-controller/">Cloud Controller Manager (CCM)</a> was introduced in Kuberentes 1.6 to offload control loops that integrate with cloud services from the <a href="https://kubernetes.io/docs/concepts/overview/components/#kube-controller-manager">Kubernetes Controller Manager (KCM)</a>.
Three of the four cloud dependent controllers - node, route, and service - have been moved to the Cloud Controller Manager.
A fourth, the volume controller, was replaced with the Flex Volume plugin framework rather than being ported directlly from the KCM to the CCM.
As of Kubernetes 1.10, a newer plugin system, <a href="https://github.com/container-storage-interface/spec/blob/master/spec.md">Container Storage Interface (CSI)</a> has been designated as the successor to Flex Volumes.
CSI plugins are similar to Flex Volumes but run in pods rather than as binaries on the host.</p>

<p>Replicated is monitoring progress of the CSI framework and may add support for plugins that will dynamically provision volumes such as EBS on AWS.
For now, customers who wish to use EBS volumes with Replicated may choose to mount a volume on each host at <code>/opt/replicated/rook</code>, effectively backing Rook with EBS storage.
Alternatively, Rook can be disabled entirely by setting the <code>storage_provisioner</code> parameter to 0, which would require sysadmins to manually provision an EBS volume for each of the four Persistent Volume Claims defined by Replicated in addition to any required to run your app.</p>


<h2 class="linked-headline" id="tips">
    <a href="/guides/ship-with-kubernetes/managing-storage/#tips" class="anchor" id="#tips"></a>
    Tips
</h2>


<p>Deployments with Pods that mount Persistent Volumes should specify an update strategy type of <code>Recreate</code> or a <code>RollingUpdate</code> with a <code>maxUnavailable</code> value of <code>1</code>.
The default <code>RollingUpdate</code> with <code>maxUnavailable</code> value of <code>25%</code> will prevent old Pods from terminating and yielding their Persistent Volumes, which will keep new Pods from starting.</p>


<h2 class="linked-headline" id="troubleshooting">
    <a href="/guides/ship-with-kubernetes/managing-storage/#troubleshooting" class="anchor" id="#troubleshooting"></a>
    Troubleshooting
</h2>


<p>The <a href="https://rook.io/docs/rook/master/toolbox.html">Rook toolbox</a> provides a convenient image for monitoring and debugging your Rook cluster. You can run it as a pod in the <code>rook</code> namespace and have access to commands such as <code>ceph status</code> to check the health of your storage cluster.</p>

                            <div class="prev-next-arrows justifyContent--spaceBetween flex u-marginTop--most">
                                <div class="next flex u-textAlign--left">
                                
                                    
                                        <a href="/guides/ship-with-kubernetes/iterate/">
                                            <span class="icon u-chevronIcon"></span>
                                            Iterating and Updating
                                        </a>
                                    
                                
                                </div>
                                <div class="previous flex u-textAlign--right">
                                
                                    
                                
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div>
            
        </div>
    </article>
</main>
	<footer>
		<div class="container">
			<div class="footer-items-wrapper">
        <div class="footer-list flex1 paddingContainer">
					<div class="footer-list-item">
  <div class="footer-item">
    <div class="u-paddingBottom--normal">
      <a target="_blank" class="u-cursor--pointer" href="https://www.replicated.com">
        <img width="130" src="/images/footer_logo@2x.png"/>
      </a>
    </div>
    <div class="u-fontSize--small u-color--dustyGray u-marginBottom--small u-hidden--mobileTablet">&copy; 2018 <a> &nbsp;Replicated Inc.</a></div>
    <div class="u-fontSize--small u-color--dustyGray u-hidden--mobileTablet">All Rights Reserved</div>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Help Center</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/guides">Guides</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/docs">Documentation</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="/api">API Reference</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://vendor.replicated.com/support">Contact Support</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Company</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com">About Replicated</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://blog.replicated.com">Replicated Blog</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.replicated.com/careers">Careers</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover">RSS Feed</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">Contact</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://twitter.com/replicatedhq">Twitter</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="mailto:contact@replicated.com">Email</a></li>
    </ul>
  </div>
</div><div class="footer-list-item">
  <div class="footer-item">
    <p class="u-fontWeight--medium u-color--tuna">More</p>
    <ul>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://github.com/replicatedhq">GitHub</a></li>
      <li><a class="u-color--dustyGray u-textDecoration--underlineOnHover" href="https://www.enterpriseready.io">EnterpriseReady.io</a></li>
    </ul>
  </div>
</div>

        </div>
			</div>
		</div>
	</footer>

	
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-61084834-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
      </script>
    
 
	<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
	<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>

  
  

    
    
      
        <script src="/js/prod/autocomplete-search.js"></script>
      
      
    

  

	<script src="/js/prism.js"></script>
	<script>
		function toggleMenuClass() {
			this.classList.toggle("open");
			document.getElementById("headerLinks").classList.toggle("show");
		}
		const toggleMenu = document.getElementById("toggleNav");
		if (toggleMenu) {
			toggleMenu.addEventListener("click", toggleMenuClass);
		};
	</script>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="/js/featherlight.min.js"></script>
	<script>
		$('#desktop-search').on("click", function () {
      if(!$('#search-field').is(":visible")) {
        $('#search-field').show("slide", { direction: "right" }, 300);
        $('#search-field').focus();
      }
		});

    $('#search-field').on("blur", function () {
      $(this).hide("slide", { direction: "right" }, 300);
    });

    $('#dropdown-link').on('click', function() {
      $('#scheduler-dropdown-menu').toggle();
    });

    $(document).on('click', function(e) {
      var target = e.target;
      if(target.id !== "dropdown-link") {
        $('#scheduler-dropdown-menu').hide();
      }
    });

    $('.tooltip').tooltip({
      position: {  my: "center bottom-10", at: "center top"  },
      show: { effect: "fade", duration: 200 },
      hide: { effect: "fade", duration: 200 }
    });
	</script>
</body>
</html>
